{
  "uid": "infrastructure",
  "title": "üèóÔ∏è Infrastructure Monitoring",
  "tags": ["infrastructure", "cluster", "resources"],
  "panels": [
    {
      "datasource": "Prometheus",
      "title": "ÔøΩ Container Memory Usage by Namespace",
      "type": "graph",
      "targets": [
        {
          "expr": "sum(container_memory_usage_bytes{namespace=~\"ingress-nginx|suma-ecommerce|suma-office|monitoring|kube-system|elasticsearch\", pod!=\"\"}) by (namespace) / 1024 / 1024",
          "legendFormat": "{{namespace}} (MB)"
        }
      ],
      "yAxes": [
        {
          "label": "Memory (MB)",
          "min": 0
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 }
    },
    {
      "datasource": "Prometheus",
      "title": "üñ•Ô∏è Container CPU Usage by Namespace",
      "type": "graph",
      "targets": [
        {
          "expr": "sum(rate(container_cpu_usage_seconds_total{namespace=~\"ingress-nginx|suma-ecommerce|suma-office|monitoring|kube-system|elasticsearch\", pod!=\"\"}[5m])) by (namespace) * 100",
          "legendFormat": "{{namespace}} (%)"
        }
      ],
      "yAxes": [
        {
          "label": "CPU Usage (%)",
          "min": 0
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 0 }
    },
    {
      "datasource": "Prometheus",
      "title": "üìä Active Pods by Namespace",
      "type": "piechart",
      "targets": [
        {
          "expr": "count by (namespace) (container_start_time_seconds{namespace=~\"ingress-nginx|suma-ecommerce|suma-office|monitoring|kube-system|elasticsearch\", pod!=\"\"})",
          "legendFormat": "{{namespace}}"
        }
      ],
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 8 }
    },
    {
      "datasource": "Prometheus",
      "title": "üîÑ Container Restarts",
      "type": "stat",
      "targets": [
        {
          "expr": "sum(increase(container_start_time_seconds{namespace=~\"ingress-nginx|suma-ecommerce|suma-office|monitoring|kube-system|elasticsearch\"}[1h]))",
          "instant": true,
          "legendFormat": "Container Restarts (1h)"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "min": 0,
          "thresholds": {
            "steps": [
              { "color": "green", "value": 0 },
              { "color": "yellow", "value": 5 },
              { "color": "red", "value": 10 }
            ]
          }
        }
      },
      "gridPos": { "h": 4, "w": 12, "x": 12, "y": 8 }
    },
    {
      "datasource": "Prometheus",
      "title": "Service Availability",
      "type": "table",
      "targets": [
        {
          "expr": "up",
          "format": "table",
          "instant": true
        }
      ],
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Time": true,
              "__name__": true,
              "beta_kubernetes_io_arch": true,
              "beta_kubernetes_io_os": true,
              "kubernetes_io_arch": true,
              "kubernetes_io_hostname": true,
              "kubernetes_io_os": true
            },
            "renameByName": {
              "job": "Service",
              "instance": "Endpoint",
              "Value": "Status"
            }
          }
        }
      ],
      "fieldConfig": {
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Status"
            },
            "properties": [
              {
                "id": "mappings",
                "value": [
                  {
                    "options": {
                      "0": { "text": "DOWN", "color": "red" },
                      "1": { "text": "UP", "color": "green" }
                    },
                    "type": "value"
                  }
                ]
              }
            ]
          }
        ]
      },
      "gridPos": { "h": 6, "w": 24, "x": 0, "y": 16 }
    }
  ],
  "time": { "from": "now-1h", "to": "now" }
}
