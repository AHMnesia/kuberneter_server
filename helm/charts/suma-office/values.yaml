replicaCount: 2
revisionHistoryLimit: 3

namespace: suma-office

image:
  repository: suma-office-api
  tag: latest
  pullPolicy: Never

workingDir: /var/www/html

strategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 1
    maxSurge: 0

nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
    ephemeral-storage: "250Mi"
  limits:
    memory: "512Mi"
    cpu: "400m"
    ephemeral-storage: "1Gi"

# Application Configuration
config:
  appName: "Suma Office API"
  appEnv: production
  appDebug: false
  appUrl: "https://api.suma-honda.id"
  dbConnection: mysql
  cacheDriver: redis
  queueConnection: redis
  elasticsearchHosts: "https://suma-platform-elasticsearch:9200"
  
  # ConfigMap data
  timezone: "Asia/Jakarta"
  maxFileSize: "50M"
  maxExecutionTime: "600"
  memoryLimit: "512M"

envFrom:
  - configMapRef:
      name: suma-office-config

startupProbe:
  enabled: true
  path: /
  initialDelaySeconds: 30
  periodSeconds: 10
  failureThreshold: 30

livenessProbe:
  enabled: true
  path: /
  initialDelaySeconds: 120
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3

readinessProbe:
  enabled: true
  path: /
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 3

# Persistence
persistence:
  enabled: true
  volumes:
    - name: storage
      size: 2Gi
      mountPath: /var/www/html/storage
      storageClassName: standard
      accessModes:
        - ReadWriteOnce
    - name: uploads
      size: 1Gi
      mountPath: /var/www/html/public/uploads
      storageClassName: standard
      accessModes:
        - ReadWriteOnce

# Redis Configuration
redis:
  enabled: true
  host: redis-master
  port: 6379

# Network Policy
networkPolicy:
  enabled: true
  allowedNamespaces:
    - ingress-nginx
    - nginx-system

# Service
service:
  type: ClusterIP
  port: 8000

# Ingress
ingress:
  enabled: true
  className: nginx
  hosts:
    - name: local
      host: suma-office.local
      tls: true
      tlsSecret: suma-office-tls
      annotations:
        kubernetes.io/ingress.class: "nginx"
      paths:
        - path: /
          pathType: Prefix
    - name: api
      host: api.suma-honda.id
      tls: true
      tlsSecret: api-suma-honda-id-tls
      annotations:
        kubernetes.io/ingress.class: "nginx"
        nginx.ingress.kubernetes.io/use-regex: "true"
        nginx.ingress.kubernetes.io/rewrite-target: "/$2"
        nginx.ingress.kubernetes.io/proxy-body-size: "10m"
        nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
        nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
        nginx.ingress.kubernetes.io/proxy-http-version: "1.1"
        nginx.ingress.kubernetes.io/proxy-buffering: "off"
      paths:
        - path: /office(/|$)(.*)
          pathType: ImplementationSpecific

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 4
  targetCPUUtilizationPercentage: 50
  targetMemoryUtilizationPercentage: 50
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 300
      policies:
      - type: Pods
        value: 1
        periodSeconds: 60
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Pods
        value: 1
        periodSeconds: 60

certificate:
  enabled: true
  certificates:
    - name: suma-office-local-tls
      secretName: suma-office-tls
      issuerRef:
        name: selfsigned-cluster-issuer
        kind: ClusterIssuer
      dnsNames:
        - suma-office.local